"use strict";(self.webpackChunkguide_generator=self.webpackChunkguide_generator||[]).push([[567],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||i;return n?a.createElement(h,o(o({ref:t},p),{},{components:n})):a.createElement(h,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var c=2;c<i;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},5687:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const i={},o="Lab 2 - E2E (Part 2)",s={unversionedId:"lab2",id:"lab2",title:"Lab 2 - E2E (Part 2)",description:"Getting Started",source:"@site/docs/lab2.md",sourceDirName:".",slug:"/lab2",permalink:"/cypress-heroes-workshop/lab2",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Lab 1 - E2E (Part 1)",permalink:"/cypress-heroes-workshop/lab1"},next:{title:"Lab 3 - CT (Part 1)",permalink:"/cypress-heroes-workshop/lab3"}},l={},c=[{value:"Getting Started",id:"getting-started",level:2},{value:"Writing A More Advanced Test",id:"writing-a-more-advanced-test",level:2},{value:"Invoke",id:"invoke",level:3},{value:"Custom Commands",id:"custom-commands",level:2},{value:"getBySel()",id:"getbysel",level:3},{value:"Login",id:"login",level:3},{value:"Extra Credit",id:"extra-credit",level:2}],p={toc:c};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"lab-2---e2e-part-2"},"Lab 2 - E2E (Part 2)"),(0,r.kt)("h2",{id:"getting-started"},"Getting Started"),(0,r.kt)("p",null,"To get started, make sure to checkout the ",(0,r.kt)("inlineCode",{parentName:"p"},"lab2-start")," branch:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"git checkout lab2-start\n")),(0,r.kt)("p",null,"You can find a completed version of this lab in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cypress-io/cypress-heroes-workshop/tree/lab3-start"},"lab3-start")," branch."),(0,r.kt)("h2",{id:"writing-a-more-advanced-test"},"Writing A More Advanced Test"),(0,r.kt)("p",null,"Now that you have a good working test written, it is time to write a more advanced test that validates that the number of saves and likes gets incremented upon click."),(0,r.kt)("h3",{id:"invoke"},"Invoke"),(0,r.kt)("p",null,"You will need to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"cy.invoke()")," method and some javascript to write this test."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title='./client/cypress/e2e/spec.cy.ts'",title:"'./client/cypress/e2e/spec.cy.ts'"},"describe('Hiring A Hero', () => {\n  \n  beforeEach(() => {\n   ...\n  })\n\n  it('can hire the Smoker', () => { ... }\n\n  it('increments the count when liking and hiring', () => {\n    // we need a javascript variable to store the value of saves\n    let saves = 0\n\n    cy.get('app-hero-list>ul')\n      // this gets the list items <li>\n      .children()\n      // this gets the very last list item\n      .last()\n      // this scopes the subsequent cypress commands to within this element\n      .within(() => {\n        // get the number of current fans\n        cy.get('[data-cy=fans]')\n          // invokes a function on the yielded subject (element)\n          .invoke('text')\n          // convert that value as a string to a Number\n          .then(Number)\n          // then create a function to work with this number\n          .then(n => {\n            // click the like button\n            cy.get('[data-cy=like]').click()\n            // get the number of current fans now\n            cy.get('[data-cy=fans]')\n              // make sure the new number is 1 more than the previous\n              .contains(\n                // Need to convert it back to a string\n                String(n + 1)\n              )\n          })\n        \n        // do the same thing for saves\n        cy.get('[data-cy=saves]')\n          .invoke('text')\n          .then(Number)\n          .then(n => {\n            // assign the saves variable we previously created to the current value of saves in the DOM\n            saves = n\n          })\n        // click the hire button\n        cy.get('[data-cy=hire]').click()\n      })\n\n      // we have to leave the context of the last hero item to confirm the hire\n      cy.get('[data-cy=confirm-hero-name]').contains('Fly Girl')\n      cy.get('[data-cy=confirm-hire]').click()\n\n      // we need to reestablish the context of the last hero\n      cy.get('app-hero-list>ul').children().last().within(() => {\n        // get the number of saves now in the DOM\n        cy.get('[data-cy=saves]')\n          // make sure the new number is 1 more than the previous\n          .contains(\n            // Need to convert it back to a string\n            String(saves + 1)\n          )\n      })\n  })\n")),(0,r.kt)("p",null,"You now have another passing test that makes sure the value which is dynamic and seeded from the database is incremented when either the like or hire buttons are clicked."),(0,r.kt)("h2",{id:"custom-commands"},"Custom Commands"),(0,r.kt)("p",null,"Though your selectors are written in a way that will save you headaches you may have noticed it isn't the easiest thing to type over and over. Thankfully Cypress comes with its own API for creating custom commands. Now its time to create a custom command to make this easier. "),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"We recommend defining quieries in your ",(0,r.kt)("inlineCode",{parentName:"p"},"cypress/support/commands.ts")," file, since it is loaded before any test files are evaluated via an import state in the ",(0,r.kt)("inlineCode",{parentName:"p"},"cypress/support/e2e.ts")," file")),(0,r.kt)("h3",{id:"getbysel"},"getBySel()"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title='./client/cypress/support/commands.ts'",title:"'./client/cypress/support/commands.ts'"},"declare namespace Cypress {\n  interface Chainable {\n    getBySel(selector: string): Chainable\n  }\n}\n\nCypress.Commands.add('getBySel', (selector: string, ...args): Cypress.Chainable => {\n  return cy.get(`[data-cy=${selector}]`, ...args)\n})\n")),(0,r.kt)("p",null,"Now that you have a new custom command created you can now go in and replace all of your ",(0,r.kt)("inlineCode",{parentName:"p"},"cy.get('[data-cy=fans]')")," commands with the new syntax ",(0,r.kt)("inlineCode",{parentName:"p"},"cy.getBySel('fans')"),". "),(0,r.kt)("h3",{id:"login"},"Login"),(0,r.kt)("p",null,"Though we have 2 working tests, in a real-world app, your Cypress test suite will end up with more than 1 spec file. Inevitably you will run into a scenario where you need to reuse code or functionality across spec files. ",(0,r.kt)("strong",{parentName:"p"},"Login")," is a good example of this in the Heroes App. So now move the login code from the ",(0,r.kt)("inlineCode",{parentName:"p"},"beforeEach()")," hook to a custom ",(0,r.kt)("inlineCode",{parentName:"p"},"login")," command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title='./client/cypress/support/commands.ts'",title:"'./client/cypress/support/commands.ts'"},"declare namespace Cypress {\n  interface Chainable {\n    getBySel(selector: string): Chainable\n    login(email?: string, password?: string): void\n  }\n}\n\nCypress.Commands.add('getBySel', (selector: string, ...args): Cypress.Chainable => {\n  return cy.get(`[data-cy=${selector}]`, ...args)\n})\n\nCypress.Commands.add('login', (email = 'test@test.com', password = 'test123'): void => {\n  // notice we can still reference our other custom commands here!\n  cy.getBySel('login').contains('Login').click()\n  cy.get('input[type=email]').type('test@test.com')\n  cy.get('input[type=password]').type('test123')\n  cy.get('button').contains('Sign in').click()\n})\n")),(0,r.kt)("p",null,"Now all you need to do is change your ",(0,r.kt)("inlineCode",{parentName:"p"},"beforeEach()")," hook:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title='./client/cypress/e2e/spec.cy.ts'",title:"'./client/cypress/e2e/spec.cy.ts'"},"describe('Hiring A Hero', () => {\n  \n  beforeEach(() => {\n    // visit the app\n    cy.visit('/')\n    cy.login()\n  })\n")),(0,r.kt)("h2",{id:"extra-credit"},"Extra Credit"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"create a new spec called ",(0,r.kt)("inlineCode",{parentName:"li"},"admin.cy.ts")),(0,r.kt)("li",{parentName:"ul"},"write tests to make sure admins can create, update, and delete heroes"),(0,r.kt)("li",{parentName:"ul"},"note: you will need to login using the admin credentials ",(0,r.kt)("a",{parentName:"li",href:"/#get-to-know-the-app"},"found here")),(0,r.kt)("li",{parentName:"ul"},"note: I recommend not deleting the first or last heroes as the test we just wrote will break")))}d.isMDXComponent=!0}}]);